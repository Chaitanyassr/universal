/*!
GPII Lifecycle Manager Tests

Copyright 2019 OCAD University

Licensed under the New BSD license. You may not use this file except in
compliance with this License.

The research leading to these results has received funding from the European Union's
Seventh Framework Programme (FP7/2007-2013) under grant agreement no. 289016.

You may obtain a copy of the License at
https://github.com/GPII/universal/blob/master/LICENSE.txt
*/

"use strict";

var fluid = require("infusion"),
    gpii = fluid.registerNamespace("gpii"),
    jqUnit = fluid.require("node-jqunit", require, "jqUnit");

require("lifecycleManager");

fluid.registerNamespace("gpii.tests.lifecycleManager");

jqUnit.test("Test gpii.lifecycleManager.removeNoMatchSettings() to remove unmatched settings ", function () {
    jqUnit.expect(1);
    var testCases = {
        common: {
            message: "Remove unmatched settings",
            settingValues: {
                "org.gnome.desktop.a11y.magnifier": {
                    "mag-factor": 2,
                    "screen-position": "full-screen"
                }
            },
            preference: {
                "http://registry.gpii.net/applications/org.gnome.desktop.a11y.magnifier": {
                    "http://registry.gpii.net/common/magnification": 2
                }
            },
            solutionRegistryEntries: {
                "org.gnome.desktop.a11y.magnifier": {
                    "name": "GNOME Shell Magnifier",
                    "capabilities": [
                        "http://registry\\.gpii\\.net/common/magnification/enabled"
                    ],
                    "settingsHandlers": {
                        "configuration": {
                            "type": "gpii.gsettings",
                            "liveness": "live",
                            "options": {
                                "schema": "org.gnome.desktop.a11y.magnifier"
                            },
                            "supportedSettings": {
                                "mag-factor": {

                                },
                                "show-cross-hairs": {

                                },
                                "focus-tracking": {

                                },
                                "caret-tracking": {

                                },
                                "mouse-tracking": {

                                },
                                "screen-position": {

                                }
                            },
                            "capabilitiesTransformations": {
                                "mag-factor": "http://registry\\.gpii\\.net/common/magnification",
                                "show-cross-hairs": "http://registry\\.gpii\\.net/common/showCrosshairs",
                                "transform": {
                                    "type": "fluid.transforms.arrayToSetMembership",
                                    "inputPath": "http://registry\\.gpii\\.net/common/tracking",
                                    "outputPath": "",
                                    "presentValue": "proportional",
                                    "missingValue": "none",
                                    "options": {
                                        "focus": "focus-tracking",
                                        "caret": "caret-tracking",
                                        "mouse": "mouse-tracking"
                                    }
                                },
                                "screen-position": {
                                    "transform": {
                                        "type": "fluid.transforms.valueMapper",
                                        "defaultInputPath": "http://registry\\.gpii\\.net/common/magnifierPosition",
                                        "match": {
                                            "FullScreen": "full-screen",
                                            "Lens": "full-screen",
                                            "LeftHalf": "left-half",
                                            "RightHalf": "right-half",
                                            "TopHalf": "top-half",
                                            "BottomHalf": "bottom-half"
                                        },
                                        "noMatch": {
                                            "outputValue": "full-screen"
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            },
            expected: {
                "org.gnome.desktop.a11y.magnifier": {
                    "mag-factor": 2,
                }
            }
        }
    };

    fluid.each(testCases, function (testCase) {
        var result = gpii.lifecycleManager.removeNoMatchSettings(testCase.settingValues, testCase.preference, testCase.solutionRegistryEntries);
        jqUnit.assertDeepEq(testCase.message, testCase.expected, result);
    });
});
